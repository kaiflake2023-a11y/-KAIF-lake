# Кайф Озеро - PWA Мессенджер

## Обзор проекта
- **Название**: Кайф Озеро (Kaif Lake Messenger)
- **Цель**: Создание упрощенной PWA-версии мессенджера с функциональностью, похожей на Telegram
- **Платформа**: Cloudflare Pages с edge-функциями Workers
- **Технологии**: Hono Framework, TypeScript, Tailwind CSS, PWA

## Основные функции

### ✅ Реализованные функции
1. **Система авторизации**
   - Регистрация новых пользователей
   - Вход по имени пользователя или email
   - JWT токены для сессий
   - Безопасное хэширование паролей (bcrypt)

2. **Чаты**
   - Создание личных чатов (direct)
   - Создание групповых чатов
   - Создание каналов
   - Просмотр списка чатов с последними сообщениями
   - Счетчик непрочитанных сообщений

3. **Сообщения**
   - Отправка текстовых сообщений
   - Просмотр истории сообщений
   - Ответы на сообщения
   - Редактирование своих сообщений
   - Удаление сообщений
   - Реакции на сообщения (эмодзи)
   - Отметки о прочтении

4. **Пользователи**
   - Поиск пользователей
   - Просмотр профилей
   - Редактирование своего профиля
   - Управление контактами
   - Статусы онлайн/офлайн

5. **PWA функции**
   - Установка приложения на устройство
   - Работа офлайн (кэширование)
   - Service Worker для фоновой синхронизации
   - Манифест для полноэкранного режима

## API Endpoints

### Авторизация
- `POST /api/auth/register` - Регистрация нового пользователя
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/logout` - Выход из системы

### Пользователи
- `GET /api/users/me` - Получить текущего пользователя
- `PUT /api/users/me` - Обновить профиль
- `GET /api/users/search?q={query}` - Поиск пользователей
- `GET /api/users/:id` - Получить пользователя по ID
- `GET /api/users/me/contacts` - Список контактов
- `POST /api/users/me/contacts` - Добавить контакт

### Чаты
- `GET /api/chats` - Список чатов пользователя
- `POST /api/chats` - Создать новый чат
- `GET /api/chats/:id` - Информация о чате
- `POST /api/chats/:id/read` - Отметить чат как прочитанный

### Сообщения
- `GET /api/messages?chat_id={id}` - Получить сообщения чата
- `POST /api/messages` - Отправить сообщение
- `PUT /api/messages/:id` - Редактировать сообщение
- `DELETE /api/messages/:id` - Удалить сообщение
- `POST /api/messages/:id/reactions` - Добавить/убрать реакцию

## Архитектура данных

### База данных (Cloudflare D1 - SQLite)
- **users** - Пользователи системы
- **chats** - Чаты (личные, группы, каналы)
- **chat_members** - Участники чатов
- **messages** - Сообщения
- **message_reactions** - Реакции на сообщения
- **sessions** - Сессии пользователей
- **contacts** - Контакты пользователей

### Хранилища
- **Cloudflare D1** - Основная база данных
- **Cloudflare KV** - Кэш и сессии (подготовлено)
- **Cloudflare R2** - Хранение медиафайлов (подготовлено)

## Установка и запуск

### Локальная разработка
```bash
# Установка зависимостей
npm install

# Создание и применение миграций БД
npm run db:reset
npm run db:seed  # Опционально: добавить тестовые данные

# Сборка проекта
npm run build

# Запуск локального сервера
npm run dev:sandbox
```

### Деплой на Cloudflare Pages
```bash
# Создание production базы данных
npx wrangler d1 create kaif-lake-production

# Применение миграций
npx wrangler d1 migrations apply kaif-lake-production

# Деплой
npm run deploy:prod
```

## Использование

1. **Регистрация**: Создайте новый аккаунт с уникальным именем пользователя
2. **Поиск пользователей**: Используйте поиск для нахождения других пользователей
3. **Создание чата**: Кликните на пользователя для начала диалога
4. **Отправка сообщений**: Введите текст и нажмите Enter или кнопку отправки
5. **PWA установка**: В браузере появится предложение установить приложение

## Технические особенности

### Ограничения Cloudflare Workers
- Нет WebSocket (используется polling каждые 3 секунды)
- Ограничение CPU времени: 10-30мс на запрос
- Размер bundle: до 10MB
- Нет файловой системы

### Безопасность
- Пароли хэшируются с помощью bcrypt
- JWT токены для авторизации
- CORS настроен для защиты API
- SQL injection защита через prepared statements

## Планы развития

### Ближайшие улучшения
1. Загрузка и отправка изображений через R2
2. Голосовые сообщения
3. Видео сообщения
4. Стикеры и GIF
5. Push-уведомления
6. Темная/светлая тема
7. Шифрование сообщений

### Долгосрочные планы
1. Видеозвонки через WebRTC
2. Боты и интеграции
3. Каналы с подписчиками
4. Форматирование текста (Markdown)
5. Переводчик сообщений
6. Экспорт чатов

## Статус проекта
- **Платформа**: Cloudflare Pages
- **Статус**: ✅ Готов к тестированию
- **Версия**: 1.0.0
- **Последнее обновление**: 2025-09-21

## Лицензия
MIT License

## Контакты
Для вопросов и предложений создайте issue в репозитории проекта.